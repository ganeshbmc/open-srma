{% extends "base.html" %}
{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="mb-0">Change Requests — {{ project.name }}</h1>
    <a href="{{ url_for('list_form_fields', project_id=project.id) }}" class="btn btn-secondary">Back to Form</a>
  </div>

  <div class="card">
    <div class="list-group list-group-flush">
      {% for r in requests %}
        <div class="list-group-item">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="fw-semibold">{{ r.action_type }} <span class="badge text-bg-warning text-uppercase">{{ r.status }}</span></div>
              <div class="small text-muted">Requested by: {{ r.requester.name }} ({{ r.requester.email }}) · {{ r.created_at }}</div>
              <pre class="mt-2 mb-0 small">{{ r.payload }}</pre>
            </div>
            <div class="ms-3">
              <form method="POST" action="{{ url_for('act_on_change_request', project_id=project.id, req_id=r.id, action='approve') }}" class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-sm btn-success">Approve</button>
              </form>
              <form method="POST" action="{{ url_for('act_on_change_request', project_id=project.id, req_id=r.id, action='reject') }}" class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-sm btn-outline-danger">Reject</button>
              </form>
            </div>
          </div>
        </div>
      {% else %}
        <div class="list-group-item text-muted">No requests.</div>
      {% endfor %}
    </div>
  </div>
{% endblock %}

